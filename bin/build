#!/bin/bash

set -e

docker system prune -af --volumes

docker buildx build \
    --cache-from=type=registry,ref=dorianmariecom/codedorian.com:latest \
    --cache-to=type=registry,ref=dorianmariecom/codedorian.com:latest,mode=max \
    --platform=linux/arm64 \
    --label service=codedorian \
    --tag dorianmariecom/codedorian.com:$(git rev-parse HEAD) \
    --tag dorianmariecom/codedorian.com:latest \
    --push \
    .
